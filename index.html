<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë°œë¡œë€íŠ¸ ë‚´ì „ ê´€ë¦¬</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background:#121212;
      color:#eee;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      padding:30px;
    }
    .container { width:1000px; }
    h1 { color:#ff4655; text-align:center; }
    .tab { display:none; }
    .active { display:block; }
    .team { border:1px solid #444; padding:15px; margin:15px 0; border-radius:5px; }
    button {
      margin:5px; padding:8px 12px; border:none; border-radius:4px;
      background:#ff4655; color:#fff; cursor:pointer;
    }
    button:hover { background:#cc3744; }

    /* Floating label input */
    .input-group { position:relative; margin:10px 0; display:inline-block; }
    .input-group input, .input-group select {
      width:200px; padding:10px;
      background:#1e1e1e; border:1px solid #555; border-radius:4px;
      color:#eee; outline:none;
    }
    .input-group label {
      position:absolute; top:50%; left:10px; transform:translateY(-50%);
      color:#aaa; pointer-events:none; transition:0.2s;
    }
    .input-group input:focus + label,
    .input-group input:not(:placeholder-shown) + label,
    .input-group select:focus + label,
    .input-group select:not([value=""]) + label {
      top:-8px; left:8px; font-size:12px; color:#ff4655; background:#121212; padding:0 4px;
    }
    ul { list-style:none; padding:0; }
    li { margin:5px 0; }
    a { color:#4eaaff; cursor:pointer; text-decoration:none; }
    a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ë°œë¡œë€íŠ¸ ë‚´ì „ ê´€ë¦¬</h1>
    <button onclick="showTab('inputTab')">âš”ï¸ ë‚´ì „ ì…ë ¥</button>
    <button onclick="showTab('usersTab')">ğŸ‘¤ ìœ ì € ê´€ë¦¬</button>
    <button onclick="showTab('registerTab')">â• ìœ ì € ë“±ë¡</button>

    <!-- ë‚´ì „ ì…ë ¥ íƒ­ -->
    <div id="inputTab" class="tab active">
      <h2>ë‚´ì „ ì •ë³´ ì…ë ¥</h2>
      <div class="input-group">
        <input id="map" type="text" placeholder=" " />
        <label for="map">ë§µ</label>
      </div>
      <div class="input-group">
        <input id="score" type="text" placeholder=" " />
        <label for="score">ìŠ¤ì½”ì–´ (ì˜ˆ: 13-11)</label>
      </div>
      <div class="input-group">
        <select id="winner">
          <option value=""> </option>
          <option value="team1">íŒ€1</option>
          <option value="team2">íŒ€2</option>
        </select>
        <label for="winner">ìŠ¹ë¦¬ íŒ€</label>
      </div>

      <div class="team">
        <h3>íŒ€ 1</h3>
        <div id="team1"></div>
      </div>
      <div class="team">
        <h3>íŒ€ 2</h3>
        <div id="team2"></div>
      </div>

      <button onclick="saveMatch()">ì €ì¥</button>
    </div>

    <!-- ìœ ì € ê´€ë¦¬ íƒ­ -->
    <div id="usersTab" class="tab">
      <h2>ìœ ì € ê´€ë¦¬</h2>
      <div id="userList"></div>
      <div id="userDetail"></div>
    </div>

    <!-- ìœ ì € ë“±ë¡ íƒ­ -->
    <div id="registerTab" class="tab">
      <h2>ìœ ì € ë“±ë¡</h2>
      <div class="input-group">
        <input id="regName" type="text" placeholder=" " />
        <label for="regName">ì´ë¦„</label>
      </div>
      <div class="input-group">
        <input id="regRiotId" type="text" placeholder="ë‹‰ë„¤ì„#íƒœê·¸" />
        <label for="regRiotId">Riot ID</label>
      </div>
      <button onclick="registerUser()">ë“±ë¡</button>
      <h3>ë“±ë¡ëœ ìœ ì €</h3>
      <ul id="registeredUsers"></ul>
    </div>
  </div>

  <!-- ğŸ”¥ Firebase compat SDK -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script>
    // ====== ğŸ”§ ì—¬ê¸°ì— ë³¸ì¸ Firebase í”„ë¡œì íŠ¸ ì„¤ì •ì„ ë„£ìœ¼ì„¸ìš” ======
    const firebaseConfig = {
      apiKey: "ğŸ”¥YOUR_FIREBASE_API_KEYğŸ”¥",
      authDomain: "ğŸ”¥YOUR_PROJECT.firebaseapp.comğŸ”¥",
      projectId: "ğŸ”¥YOUR_PROJECT_IDğŸ”¥",
      storageBucket: "ğŸ”¥YOUR_PROJECT.appspot.comğŸ”¥",
      messagingSenderId: "ğŸ”¥YOUR_SENDER_IDğŸ”¥",
      appId: "ğŸ”¥YOUR_APP_IDğŸ”¥"
    };
    // ================================================

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let users = [];
    let matches = [];

    async function loadUsers(){
      users=[];
      const snapshot = await db.collection("users").get();
      snapshot.forEach(docSnap=>{
        users.push(docSnap.data());
      });
      renderRegisteredUsers();
      createPlayerInputs("team1");
      createPlayerInputs("team2");
    }

    async function loadMatches(){
      matches=[];
      const snapshot = await db.collection("matches").get();
      snapshot.forEach(docSnap=>{
        matches.push(docSnap.data());
      });
    }

    function createPlayerInputs(teamId) {
      let html = "";
      for (let i=0; i<5; i++) {
        html += `
          <div style="margin:10px 0;">
            <select class="${teamId}-user">
              <option value="">ìœ ì € ì„ íƒ</option>
              ${users.map(u => `<option value="${u.riotid}">${u.name} (${u.riotid})</option>`).join("")}
            </select>
            <input type="number" class="${teamId}-score" placeholder="í‰ê·  ì ìˆ˜" style="width:100px">
            <input type="number" class="${teamId}-kills" placeholder="í‚¬" style="width:60px">
            <input type="number" class="${teamId}-deaths" placeholder="ë°ìŠ¤" style="width:60px">
            <input type="number" class="${teamId}-assists" placeholder="ì–´ì‹œ" style="width:60px">
          </div>
        `;
      }
      document.getElementById(teamId).innerHTML = html;
    }

    async function registerUser(){
      const name=document.getElementById("regName").value.trim();
      const riotid=document.getElementById("regRiotId").value.trim();
      if(!name||!riotid) return alert("ì´ë¦„ê³¼ Riot IDë¥¼ ì…ë ¥í•˜ì„¸ìš”");
      await db.collection("users").doc(riotid).set({name,riotid});
      await loadUsers();
      document.getElementById("regName").value="";
      document.getElementById("regRiotId").value="";
      alert("ìœ ì € ë“±ë¡ ì™„ë£Œ!");
    }

    function renderRegisteredUsers(){
      let html="";
      users.forEach(u=>{
        html+=`<li>${u.name} (${u.riotid})</li>`;
      });
      document.getElementById("registeredUsers").innerHTML=html;
    }

    async function saveMatch() {
      const map = document.getElementById("map").value;
      const score = document.getElementById("score").value;
      const winner = document.getElementById("winner").value;

      function collectTeam(teamId) {
        let players = [];
        for (let i=0; i<5; i++) {
          const riotid = document.getElementsByClassName(`${teamId}-user`)[i].value;
          const user = users.find(u=>u.riotid===riotid) || {};
          players.push({
            name: user.name || "",
            riotid: riotid,
            score: parseInt(document.getElementsByClassName(`${teamId}-score`)[i].value||0),
            kills: parseInt(document.getElementsByClassName(`${teamId}-kills`)[i].value||0),
            deaths: parseInt(document.getElementsByClassName(`${teamId}-deaths`)[i].value||0),
            assists: parseInt(document.getElementsByClassName(`${teamId}-assists`)[i].value||0)
          });
        }
        return players;
      }

      const match = {map, score, winner, team1: collectTeam("team1"), team2: collectTeam("team2")};
      await db.collection("matches").add(match);
      await loadMatches();
      alert("ì €ì¥ ì™„ë£Œ!");
    }

    function showTab(tabId) {
      document.querySelectorAll(".tab").forEach(div => div.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
      if(tabId==="usersTab") renderUsers();
    }

    function renderUsers() {
      let userMap = {};
      users.forEach(u=>{
        if (!userMap[u.riotid]) {
          userMap[u.riotid] = { name:u.name, riotid:u.riotid, matches:[] };
        }
      });
      matches.forEach(m=>{
        ["team1","team2"].forEach(t=>{
          m[t].forEach(p=>{
            if(!p.riotid) return;
            if(!userMap[p.riotid]) userMap[p.riotid]={name:p.name,riotid:p.riotid,matches:[]};
            userMap[p.riotid].matches.push({match:m,team:t,player:p});
          });
        });
      });
      let html = "<h3>ìœ ì € ëª©ë¡</h3><ul>";
      Object.values(userMap).forEach(u=>{
        html+=`<li><a onclick="showUser('${u.riotid}')">${u.name} (${u.riotid})</a></li>`;
      });
      html+="</ul>";
      document.getElementById("userList").innerHTML=html;
    }

    function showUser(riotid){
      const userMatches=[];
      matches.forEach(m=>{
        ["team1","team2"].forEach(t=>{
          m[t].forEach(p=>{
            if(p.riotid===riotid) userMatches.push({m,team:t,player:p});
          });
        });
      });
      const user=users.find(u=>u.riotid===riotid)||{name:"",riotid};
      if(userMatches.length===0){
        document.getElementById("userDetail").innerHTML=`<h3>${user.name} (${riotid})</h3>ê¸°ë¡ ì—†ìŒ`;
        return;
      }
      let totalKills=0,totalDeaths=0,totalAssists=0,wins=0,losses=0;
      let mapStats={};
      userMatches.forEach(um=>{
        const {m,team,player}=um;
        totalKills+=player.kills; totalDeaths+=player.deaths; totalAssists+=player.assists;
        const win=(m.winner===team); if(win) wins++; else losses++;
        if(!mapStats[m.map]) mapStats[m.map]={wins:0,losses:0};
        if(win) mapStats[m.map].wins++; else mapStats[m.map].losses++;
      });
      let kd=(totalDeaths===0)?"âˆ":(totalKills/totalDeaths).toFixed(2);
      let wr=((wins/(wins+losses))*100).toFixed(1);
      let html=`<h3>${user.name} (${riotid})</h3>
      ì „ì²´ ìŠ¹ë¥ : ${wr}% (${wins}ìŠ¹ ${losses}íŒ¨)<br>
      ì „ì²´ í‚¬:${totalKills} / ë°ìŠ¤:${totalDeaths} / ì–´ì‹œ:${totalAssists} / K/D:${kd}<br>
      <h4>ë§µë³„ ìŠ¹ë¥ </h4><ul>`;
      Object.entries(mapStats).forEach(([map,st])=>{
        let mwr=((st.wins/(st.wins+st.losses))*100).toFixed(1);
        html+=`<li>${map}: ${mwr}% (${st.wins}ìŠ¹ ${st.losses}íŒ¨)</li>`;
      });
      html+="</ul>";
      document.getElementById("userDetail").innerHTML=html;
    }

    // ğŸ”§ ì „ì—­ ë“±ë¡ (onclickì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
    window.showTab = showTab;
    window.saveMatch = saveMatch;
    window.registerUser = registerUser;
    window.showUser = showUser;

    // ì´ˆê¸° ë¡œë“œ
    loadUsers();
    loadMatches();
  </script>
</body>
</html>
